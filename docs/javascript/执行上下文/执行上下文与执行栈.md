# 执行上下文与执行栈

## 执行上下文

### 什么是执行上下文?

执行上下文是解析和执行 JavaScript 代码时的所在环境的抽象概念.

### 执行上下文的类型

- 全局执行上下文
- 函数执行上下文
- Eval 函数执行上下文

### 执行上下文的创建阶段

- 创建阶段

  - 绑定 `this`
    - 全局执行上下文, `this` 的值指向全局对象.
    - 函数执行上下文, `this` 的值取决于如何被调用.
  - 创建 LexicalEnvironment（词法环境）组件

    > 词法环境是一种规范类型, 基于 ECMAScript 代码的词法嵌套结构来定义标志符和具体变量和函数的关联. 一个词法环境由环境记录器和一个可能引用外部词法环境的空值组成.

    - 词法环境内部组件
      - 环境记录器: 存储变量和函数声明的实际位置
      - 外部环境的引用: 访问父级词法环境(作用域)
    - 词法环境类型
      - 全局环境: 外部环境引用为 `null`, `this` 指向全局对象.
      - 函数环境: 函数内部声明的变量存储在环境记录器中, 且外部环境可能是全局环境或者包含此函数的外部函数.

  - 创建 VariableEnvironment（变量环境）组件

- 执行阶段

### 执行上下文的重要组成属性

- this
- 作用域链(Scope chain)
- 变量对象( Variable object, VO)

## 执行栈

### 什么是执行执行栈?

函数调用栈, 是一种拥有 FILO(先进后出) 数据结构的栈, 用于存储代码运行时创建的所有执行上下文.

```js
let a = "Hello World!"

function first() {
	console.log("Inside first function")
	second()
	console.log("Again inside first function")
}

function second() {
	console.log("Inside second function")
}

first()
console.log("Inside Global Execution Context")
```

![执行上下文](/javascript/execution-context.png)
